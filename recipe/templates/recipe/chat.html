{% extends "base.html" %}
{% load static %}

{% block page_header %}
    <div class="container header-container">
        <div class="row">
            <div class="col"></div>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="container-fluid recipies-container">
            <!--title-->
            <div class="row">
                <div class="col text-center mt-1">
                    <h2 class="display-3 playball">Chat</h2>
                    <h2 class="playball">Comments, Questions and Replies</h2>
                    <hr class="gold50 mb-1">
                </div>
            </div>

            <!--Comments Form container-->    
        <div class="row comment_form my-1">
            <div class="col-10 offset-1">
            {% if request.user.is_authenticated %}
            <small class="text-muted my-2">Add comment or question</small>
            <!--Add Comment-->
            <form class="lato" id="comment" method="POST" action="{% url 'recipe' %}">
                {% csrf_token %}  
                
                {{ form.comment | as_crispy_field }} 
                {{ form.name | as_crispy_field }} 
                            
                {% if request.user.is_superuser %}
                <div>
                <label class="form-check-label" for="is_shop">Check here if in-house reply</label>
                <input class="form-check-input ml-2 mr-0" type="checkbox" id="is_shop" name="is_shop">
                </div>
                {% endif %}
                <input type="hidden" name="redirect_url" value="{{ request.get_full_path }}">
                <button class="btn btn-gold float-right" type="submit" name="comment_but" id="comment_but">
                    Submit 
                </button>
            </form>
            {% else %}
            <div class="inline float-right my-2 mr-0">
                <label class="form-check-label" for="login">
                    <a class="text-info" href="{% url 'account_signup' %}">Create an account</a> or 
                    <a class="text-info" href="{% url 'account_login' %}">login</a> to add comment
                </label>            
            </div>
            {% endif %}
            </div>
        </div>
        <hr class="gold70 my-5">
    <!--Comments container-->
        <div class="row">
            <div class="col-sm-10">
                <small class="text-muted my-2">View Comments and Replies</small> 
                <div class="table-responsive rounded">
                    <table id="chat-box" class="table table-sm table-striped table-borderless" cellspacing="0" width="100%">
                        <thead class="">
                            <tr>
                                <th colspan="5">Messages</th>
                            </tr>
                        </thead>
                        {% for comment in comments %}              
                            {% if comment.is_shop %}
                            <tr>
                                <td colspan="5" class="p-1 w-100">
                                    <p class="lato text-reddark">{{ comment.comment }}</p>
                                    <p class="lato text-right text-reddark">{{ comment.name }} - {{ comment.date_posted }}</p>
                                </td>
                            </tr>
                            <hr>
                            {% else %}
                            <tr>
                                <td colspan="5" class="p-1 w-100">
                                    <p class="">{{ comment.comment }}</p>
                                    <p class="text-right lato">{{ comment.name }} - {{ comment.date_posted }}</p>
                                </td>
                            </tr>
                            {% endif %}       
                        {% endfor %}    
                    </table>   
                </div>
            </div>
        </div>
    </div>
{% endblock %}